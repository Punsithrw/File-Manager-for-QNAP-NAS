var setCookie=function(cname,cvalue){document.cookie=cname+"="+cvalue+";path=/"},getCookie=function(cname){var name=cname+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" "){c=c.substring(1)}if(c.indexOf(name)==0){return c.substring(name.length,c.length)}}return""};$(document).ready(function(){var path=$(".js-path").val();$(".js-enter-press input").keypress(function(e){if(e.which&&e.which==13||e.keyCode&&e.keyCode==13){$(".js-submit").click();return false}else{return true}});$(".js-auth").on("click",function(){var login=$(".js-auth-login").val();pass=$(".js-auth-pass").val();if(login==""){$(".alert").addClass("alert-danger");$(".alert").html("Please type your login")}else if(pass==""){$(".alert").addClass("alert-danger");$(".alert").html("Please type your password")}else{pass=ezEncode(utf16to8(pass));$.post("./app/src/auth.php",{login:login,pass:pass},function(data,status){var jsonData=JSON.parse(data);if(jsonData.authPassed){setCookie("nasSid",jsonData.authSid);setCookie("serverName",jsonData.serverName);window.open("./public/page.php","_self")}else{$(".alert").addClass("alert-danger");$(".alert").html("You Login or Password is incorrect <br> Please try again")}})}});$(".js-submit").on("click",function(){path=$(".js-path").val();var limit=$(".js-limit").val();$.post("../app/src/list_files.php",{path:path,limit:limit},function(data,status){var jsonData=JSON.parse(data);if(!jsonData.sessionEnd){var fileString='<ul class="files-list js-files-list">';$(".files-zone").empty();var jsonDataLeng=jsonData.datas.length;for(var i=0;i<jsonDataLeng;i++){var file=jsonData.datas[i];fileString+='<li class="file-item list-group-item js-file-item" >';if(file.isfolder){fileString+='<img class="ico-folder" src="img/folder_ico.png" height=15px/>'}fileString+=file.filename;fileString+="</li>"}fileString+="</ul>";$(".js-files-zone").append(fileString)}else{alert("Session is ended, please re login")}})});$(".js-back").on("click",function(){path=$(".js-path").val();var slash=path.lastIndexOf("/");if(path.length>1&&slash===0){var result=path.slice(0,1);$(".js-path").val(result)}else if(path.length>1&&slash!=0){var result=path.slice(0,slash);$(".js-path").val(result)}$(".js-submit").click()});if($(".js-files-zone").length){console.log(document.cookie);$(".js-submit").click();path=$(".js-path").val();$(".js-files-zone").on("click",".js-file-item",function(){$(".js-file-item").removeClass("file-item-active");$(this).addClass("file-item-active")});$(".js-files-zone").on("dblclick",".js-file-item",function(){if(path=="/"){path+=$(this).text()}else{path=path+"/"+$(this).text()}$(".js-path").val(path);$(".js-submit").click()})}if($(".js-upload-form").length){var fileForm=document.forms.namedItem("fileUpload");fileForm.addEventListener("submit",function(ev){var nasSid=getCookie("nasSid"),nasIp=getCookie("serverName"),dstPath=$(".js-path").val(),form_data=new FormData(fileForm);form_data.append("sid",nasSid);form_data.append("ip",nasIp);form_data.append("path",dstPath);$.ajax({url:nasIp+"/index.php",dataType:"text",cache:false,contentType:false,processData:false,data:form_data,type:"post",success:function(response){var jsonData=JSON.parse(response);if(jsonData.ready){$(".alert").addClass("alert-success");$(".alert").html("Ready!");$(".js-submit").click()}else{$(".alert").addClass("alert-danger");$(".alert").html("Some Error Happened")}}});ev.preventDefault()},false)}});